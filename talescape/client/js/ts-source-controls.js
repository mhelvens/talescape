'use strict';

////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
define(['jquery', 'gmaps', 'angular', 'TS'], function ($, gmaps, angular) {
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////


//  ////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
	angular.module('TS').directive('tsSourceControls', function () {
//  ////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

		return {
			restrict   : 'E',
			templateUrl: 'partials/tsControls/tsSourceControls.html',
			replace    : true,
			require    : '^tsMap',

			link: function (scope, element, attrs, controller) {


				var sources = [];

				scope.running = 0;
				scope.count = 0;

				///////////////////////////////
				////// Gathering Sources //////
				//////                   //////


				controller.onSourceRegistered(function (source) {
					sources.push(source);
					++scope.count;
					source.onRun(function () { ++scope.running; });
					source.onPause(function () { --scope.running; });
				});


				///////////////////////////////
				////// Gathering Sources //////
				//////                   //////


				controller.map().controls[gmaps.ControlPosition.TOP_LEFT].push(element[0]);


				/////////////////////////////
				////// Scope Functions //////
				//////                 //////


				scope.runAll = function () {
					sources.map(function (source) {
						source.run();
					});
				};


				scope.pauseAll = function () {
					sources.map(function (source) {
						source.pause();
					});
				};

				scope.runOrPauseAll = function () {
					if (scope.running == 0) { scope.runAll(); }
					else { scope.pauseAll(); }
				};


			}
		};

//  ////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
	});
//  ////////////////////////////////////////////////////////////////////////////////////////////////////////////////////


////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
});
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
